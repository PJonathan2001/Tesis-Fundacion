name: CI/CD para Frontend (Simulación)

on:
  push:
    branches:
      - main  # Se ejecuta cada vez que hay cambios en main

jobs:
  gitleaks:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout del código
        uses: actions/checkout@v3
      
      - name: Simular escaneo de credenciales sensibles
        run: |
          echo "Ejecutando gitleaks..."
          sleep 10  # Simula revisión de 10 segundos
          echo "No se encontraron credenciales expuestas."

  testCalidadUnitaria:
    runs-on: ubuntu-latest
    needs: gitleaks  # Se ejecuta después de gitleaks
    steps:
      - name: Checkout del código
        uses: actions/checkout@v3
      
      - name: Instalar dependencias
        run: |
          echo "Instalando dependencias de Next.js..."
          sleep 10  # Simula instalación
          echo "Instalación completada."

      - name: Ejecutar pruebas unitarias
        run: |
          echo "Ejecutando pruebas unitarias con Jest..."
          sleep 30  # Simula pruebas (~30s)
          echo "Todas las pruebas pasaron exitosamente."

  SonarCloud:
    runs-on: ubuntu-latest
    needs: testCalidadUnitaria
    steps:
      - name: Simular análisis de calidad del código
        run: |
          echo "Analizando código con SonarCloud..."
          sleep 45  # Simula análisis (~45s)
          echo "Análisis de código completado."

  escaneoSeguridad:
    runs-on: ubuntu-latest
    needs: SonarCloud
    steps:
      - name: Simular escaneo de seguridad con OWASP ZAP
        run: |
          echo "Ejecutando escaneo de seguridad..."
          sleep 2m  # Simula análisis de seguridad (~2 minutos)
          echo "No se encontraron vulnerabilidades críticas."

  deploy:
    runs-on: ubuntu-latest
    needs: escaneoSeguridad
    steps:
      - name: Simular despliegue en Vercel
        run: |
          echo "Desplegando en Vercel..."
          sleep 33  # Simula despliegue (~33s)
          echo "Despliegue exitoso en Vercel."
